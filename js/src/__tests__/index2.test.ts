/**
 * @desc
 *
 * @使用场景
 *
 * @coder.yang2010@gmail.com
 * @Date    2020/7/9
 **/
import {FormulaTSVisitor} from "../FormulaTSVisitor";
import {toJSON, formulaFormat} from "../util";


describe('公式第二批', () => {

  it('visitor处理',async()=>{
    let visitor  = new FormulaTSVisitor();
    for (let i = 0, iLen = formulas.length; i < iLen; i++) {
    // for (let i = formulas.length-1, iLen = formulas.length; i < iLen; i++) {
      let formula = formulas[i];
      if(!formula) {
        continue;
      }
      let timeFLag =`公式[${i}]耗时 长度:${formula?.length}`;
      console.time(timeFLag);
      let ast  =visitor.toAst(formula);
      console.timeEnd(timeFLag);
      expect(ast).toMatchSnapshot('测试公式formulas['+i+']');
    }
    // let tree  = parseFormula(formulas[2]);
    // visitor.visit(tree);
  })
});




let formulas:string[] = [
  // "0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0-0+0+0+0+0-0+0+0+0+0-0-0+0-0+0-0+0+0+0+0+0",
   "IF((2020*100+6)<=202003,0,IF(IF((2020*100+6)<=202003,0,IF(ROUND((0+0+0+0+0+0+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='0',0,KMYE_DEBIT('733634444935020544',2020,6,'应收账款')+KMYE_CREDIT('733634444935020544',2020,6,'预收账款'))+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='0',0,KMYE_DEBIT('733634444935020544',2020,6,'预付账款')+KMYE_CREDIT('733634444935020544',2020,6,'应付账款'))+0+0+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='1',KMYE_DEBIT('733634444935020544',2020,6,'其他应收款')+KMYE_CREDIT('733634444935020544',2020,6,'其他应付款'),0)+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0-0+0+0+0+0-0+0+0+0+0-0-0+0-0+0-0+0+0+0+0+0)/10000,2)>0,ROUND((0+0+0+0+0+0+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='0',0,KMYE_DEBIT('733634444935020544',2020,6,'应收账款')+KMYE_CREDIT('733634444935020544',2020,6,'预收账款'))+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='0',0,KMYE_DEBIT('733634444935020544',2020,6,'预付账款')+KMYE_CREDIT('733634444935020544',2020,6,'应付账款'))+0+0+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='1',KMYE_DEBIT('733634444935020544',2020,6,'其他应收款')+KMYE_CREDIT('733634444935020544',2020,6,'其他应付款'),0)+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0-0+0+0+0+0-0+0+0+0+0-0-0+0-0+0-0+0+0+0+0+0)/10000,2),0.01)),IF((2020*100+6)<=202003,0,IF(ROUND((0+0+0+0+0+0+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='0',0,KMYE_DEBIT('733634444935020544',2020,6,'应收账款')+KMYE_CREDIT('733634444935020544',2020,6,'预收账款'))+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='0',0,KMYE_DEBIT('733634444935020544',2020,6,'预付账款')+KMYE_CREDIT('733634444935020544',2020,6,'应付账款'))+0+0+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='1',KMYE_DEBIT('733634444935020544',2020,6,'其他应收款')+KMYE_CREDIT('733634444935020544',2020,6,'其他应付款'),0)+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0-0+0+0+0+0-0+0+0+0+0-0-0+0-0+0-0+0+0+0+0+0)/10000,2)>0,ROUND((0+0+0+0+0+0+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='0',0,KMYE_DEBIT('733634444935020544',2020,6,'应收账款')+KMYE_CREDIT('733634444935020544',2020,6,'预收账款'))+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='0',0,KMYE_DEBIT('733634444935020544',2020,6,'预付账款')+KMYE_CREDIT('733634444935020544',2020,6,'应付账款'))+0+0+IF(QUERY_SZJDXX('733634444935020544',2020,6,'','','2','1','3200020003','4')=='1',KMYE_DEBIT('733634444935020544',2020,6,'其他应收款')+KMYE_CREDIT('733634444935020544',2020,6,'其他应付款'),0)+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0+0-0+0+0+0+0-0+0+0+0+0-0-0+0-0+0-0+0+0+0+0+0)/10000,2),0.01)),0.01))"
];
